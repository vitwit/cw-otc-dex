!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JSONRepair={})}(this,function(t){"use strict";class y extends Error{constructor(t,e){super(t+" at position "+e),this.position=e}}const u=125,e=32,O=10,N=9,J=13,S=8,j=12,I=34,r=39,k=48,m=57,T=65,$=97,E=70,R=102,h=160,d=8192,l=8202,s=8239,A=8287,C=12288,n=8220,o=8221,c=8216,i=8217,f=96,a=180;function U(t){return t>=k&&t<=m}function F(t){return g.test(t)||B(t.charCodeAt(0))}const g=/^[,:[\]{}()\n+]$/;function q(t){return v.test(t)||t&&B(t.charCodeAt(0))}const v=/^[[{\w-]$/;function z(t){return t===e||t===O||t===N||t===J}function B(t){return D(t)||H(t)}function D(t){return t===I||t===n||t===o}function G(t){return t===I}function H(t){return t===r||t===c||t===i||t===f||t===a}function K(t){return t===r}function L(t,e,r){r=2<arguments.length&&void 0!==r&&r,e=t.lastIndexOf(e);return-1!==e?t.substring(0,e)+(r?"":t.substring(e+1)):t}function M(t,e){let r=t.length;if(!z(t.charCodeAt(r-1)))return t+e;for(;z(t.charCodeAt(r-1));)r--;return t.substring(0,r)+e+t.substring(r)}const P={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},Q={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};t.JSONRepairError=y,t.jsonrepair=function(g){let v=0,b="";if(!c())throw new y("Unexpected end of json string",g.length);var t=i(44);if(t&&p(),q(g[v])&&/[,\n][ \t\r]*$/.test(b)){t||(b=M(b,","));{let t=!0,e=!0;for(;e;)t?t=!1:i(44)||(b=M(b,",")),e=c();e||(b=L(b,","));b="[\n".concat(b,"\n]")}}else t&&(b=L(b,","));for(;g.charCodeAt(v)===u||93===g.charCodeAt(v);)v++,p();if(v>=g.length)return b;throw new y("Unexpected character "+JSON.stringify(g[v]),v);function c(){p();var t=function(){if(123!==g.charCodeAt(v))return!1;{b+="{",v++,p();let e=!0;for(;v<g.length&&g.charCodeAt(v)!==u;){let t;if(e?(t=!0,e=!1):((t=i(44))||(b=M(b,",")),p()),!(x()||f())){g.charCodeAt(v)===u||123===g.charCodeAt(v)||93===g.charCodeAt(v)||91===g.charCodeAt(v)||void 0===g[v]?b=L(b,","):function(){throw new y("Object key expected",v)}();break}p();var r=i(58),n=v>=g.length,o=(r||(q(g[v])||n?b=M(b,":"):a()),c());o||(r||n?b+="null":a())}return g.charCodeAt(v)===u?(b+="}",v++):b=M(b,"}"),!0}}()||function(){if(91!==g.charCodeAt(v))return!1;{b+="[",v++,p();let t=!0;for(;v<g.length&&93!==g.charCodeAt(v);){t?t=!1:i(44)||(b=M(b,","));var e=c();if(!e){b=L(b,",");break}}return 93===g.charCodeAt(v)?(b+="]",v++):b=M(b,"]"),!0}}()||x()||function(){var t=v;if(45===g.charCodeAt(v)&&(v++,o(t)))return!0;for(;U(g.charCodeAt(v));)v++;if(46===g.charCodeAt(v)){if(v++,o(t))return!0;for(;U(g.charCodeAt(v));)v++}if(101===g.charCodeAt(v)||69===g.charCodeAt(v)){if(v++,45!==g.charCodeAt(v)&&43!==g.charCodeAt(v)||v++,o(t))return!0;for(;U(g.charCodeAt(v));)v++}{var e;if(v>t)return t=g.slice(t,v),e=/^0\d/.test(t),b+=e?'"'.concat(t,'"'):t,!0}return!1}()||r("true","true")||r("false","false")||r("null","null")||r("True","true")||r("False","false")||r("None","null")||f();return p(),t}function p(){v;let t=e();for(;t=(t=function(){if(47===g.charCodeAt(v)&&42===g.charCodeAt(v+1)){for(;v<g.length&&!function(t,e){return"*"===t[e]&&"/"===t[e+1]}(g,v);)v++;v+=2}else{if(47!==g.charCodeAt(v)||47!==g.charCodeAt(v+1))return!1;for(;v<g.length&&g.charCodeAt(v)!==O;)v++}return!0}())&&e(););v}function e(){let t="";for(var e,r;(e=z(g.charCodeAt(v)))||(r=g.charCodeAt(v))===h||r>=d&&r<=l||r===s||r===A||r===C;)t+=e?g[v]:" ",v++;return 0<t.length&&(b+=t,!0)}function i(t){return g.charCodeAt(v)===t&&(b+=g[v],v++,!0)}function w(){92===g.charCodeAt(v)&&v++}function x(t){var r,t=0<arguments.length&&void 0!==t&&t;let n=92===g.charCodeAt(v);if(n&&(v++,n=!0),B(g.charCodeAt(v))){const C=G(g.charCodeAt(v))?G:K(g.charCodeAt(v))?K:H(g.charCodeAt(v))?H:D;var o=v,c=b.length;let e='"';v++;for(var i=t?t=>F(g[t]):t=>C(g.charCodeAt(t));v<g.length&&!i(v);){if(92===g.charCodeAt(v)){var f=g.charAt(v+1);if(void 0!==Q[f])e+=g.slice(v,v+2),v+=2;else if("u"===f){let t=2;for(;t<6&&((r=g.charCodeAt(v+t))>=k&&r<=m||r>=T&&r<=E||r>=$&&r<=R);)t++;if(6===t)e+=g.slice(v,v+6),v+=6;else{if(!(v+t>=g.length))throw u=void 0,u=g.slice(v,v+6),new y('Invalid unicode character "'.concat(u,'"'),v);v=g.length}}else e+=f,v+=2}else{var a,u=g.charAt(v),f=g.charCodeAt(v);if(f===I&&92!==g.charCodeAt(v-1))e+="\\"+u;else if((a=f)===O||a===J||a===N||a===S||a===j)e+=P[u];else{if(!(32<=(a=f)&&a<=1114111))throw a=void 0,a=u,new y("Invalid character "+JSON.stringify(a),v);e+=u}v++}n&&w()}var h=B(g.charCodeAt(v)),d=(h?(e+='"',v++):e=M(e,'"'),b+=e,p(),v>=g.length),l=F(g.charAt(v));if(!t&&(h&&!d&&!l||!h&&d))return v=o,b=b.substring(0,c),x(!0);{let t=!1;p();for(;43===g.charCodeAt(v);){t=!0,v++,p();var s=(b=L(b,'"',!0)).length,A=x();b=A?function(t,e,r){return t.substring(0,e)+t.substring(e+r)}(b,s,1):M(b,'"')}t}return!0}return!1}function r(t,e){return g.slice(v,v+t.length)===t&&(b+=e,v+=t.length,!0)}function f(){for(var t=v;v<g.length&&!F(g[v]);)v++;if(v>t){if(40===g.charCodeAt(v))v++,c(),41===g.charCodeAt(v)&&(v++,59===g.charCodeAt(v))&&v++;else{for(;z(g.charCodeAt(v-1))&&0<v;)v--;t=g.slice(t,v);b+="undefined"===t?"null":JSON.stringify(t),g.charCodeAt(v)===I&&v++}return!0}}function n(t){if(!U(g.charCodeAt(v)))throw t=g.slice(t,v),new y("Invalid number '".concat(t,"', expecting a digit ").concat(g[v]?"but got '".concat(g[v],"'"):"but reached end of input"),v)}function o(t){if(v>=g.length)return b+=g.slice(t,v)+"0",1;n(t)}function a(){throw new y("Colon expected",v)}}});